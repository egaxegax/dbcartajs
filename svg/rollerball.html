<!DOCTYPE html>
<!--
Roller ball animation.
egax@bk.ru, 2021-24.
-->
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Анимация / SVG векторная карта</title>
<meta name="description" content="Анимация на svg с катящимся шаром">
<meta name="keywords" content="svg animate, roller ball">
<link rel="icon" href="../img/fav.svg" type="image/svg+xml">
<style>html,body,table{overflow:hidden;margin:0;padding:0;width:100%;height:100%}</style>
<style>.pointer { cursor: pointer; }</style>
</head>
<body>
<table><tr><td id="mcont"></td></tr></table>
<script src="../js/dbcartasvg.js"></script>
<script>
 //
function infobox(s) {
  var mtip = document.getElementById('tool');
  if(!mtip){
    var mtip = document.createElement('div');
    mtip.id = 'tool';
    mtip.className = 'pointer';
    mtip.style.textAlign = 'center';
    mtip.style.padding = '15px';
    mtip.style.color = '#333333';
    mtip.style.font = '1em arial';
    mtip.style.border = '2px solid rgba(19,64,117,0.5)';
    mtip.style.borderRadius = '4px';
    mtip.style.backgroundColor = 'rgba(250,250,250,0.9)';
    mtip.style.position = 'absolute';
    mtip.style.zIndex = '10000';
    mtip.style.display = 'none';
    document.body.appendChild(mtip);
  }
  mtip.innerHTML = s;
  mtip.style.display = 'block';
  mtip.style.left = window.innerWidth/2+'px';
  mtip.style.top = window.innerHeight/2+'px';
  setTimeout( function(){ mtip.style.display = 'none'; }, 2000 );
}
 //
function mds(o) { return Math.sqrt(DC.sizeOf()[2]*DC.sizeOf()[2]+DC.sizeOf()[3]*DC.sizeOf()[3])/2000*o; }
 //
function draw(){
  DC.append('path', {id:'door1', class:'pointer', stroke:'#ce922a', 'stroke-width':mds(6), fill:'transparent', onclick:'doorClick()', d: ('M '+ DC.interpolateCoords([[150,150],[170,150],[170,199],[150,202,'z']], true)).replace(/,/g, ' ')});
  DC.append('path', {id:'door2', class:'pointer', stroke:'#ce922a', 'stroke-width':mds(6), fill:'transparent', onclick:'doorClick()', d: ('M '+ DC.interpolateCoords([[150,44],[170,41],[170,-8],[150,-8,'z']], true)).replace(/,/g, ' ')});
  DC.append('path', {id:'door3', class:'pointer', stroke:'#ce922a', 'stroke-width':mds(6), fill:'transparent', onclick:'doorClick()', d: ('M '+ DC.interpolateCoords([[150,-118],[170,-121],[170,-170],[150,-170,'z']], true)).replace(/,/g, ' ')});
  DC.append('path', {id:'path1', stroke:'#aaa', 'stroke-width':mds(7), fill:'none', d: ('M '+ DC.interpolateCoords([[-180,-8,'T'],[-150,-8],[-70,60,'T'],[150,150]], true)).replace(/,/g, ' ')});
  DC.append('path', {id:'path2', stroke:'#aaa', 'stroke-width':mds(7), fill:'none', d: ('M '+ DC.interpolateCoords([[-180,-8,'T'],[-130,-8],[-60,-8,'T'],[0,-30],[40,-8,'T'],[150,-8]], true)).replace(/,/g, ' ')});
  DC.append('path', {id:'path3', stroke:'#aaa', 'stroke-width':mds(7), fill:'none', d: ('M '+ DC.interpolateCoords([[-180,-8],[-150,-8],[-150,-20],[-130,-20],[-130,-40],[-110,-40],[-110,-60],[-90,-60],[-90,-80],[-70,-80],[-70,-100],[150,-170]], true)).replace(/,/g, ' ')});
  DC.append('circle', {id:'ball', fill:'#c94f46', cx: DC.toPoints([-180,0])[0], cy: DC.toPoints([-180,0])[1], r: mds(40)});
  DC.append(DC.append(DC.root.getElementById('ball'), 'animateMotion', { rotate:'auto', dur:'3s', onend:'infobox("Выход 1")', begin:'door1.click', fill:'freeze' }), 'mpath', {}).setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#path1');
  DC.append(DC.append(DC.root.getElementById('ball'), 'animateMotion', { rotate:'auto', dur:'3s', onend:'infobox("Выход 2")', begin:'door2.click', fill:'freeze' }), 'mpath', {}).setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#path2');
  DC.append(DC.append(DC.root.getElementById('ball'), 'animateMotion', { dur:'3s', onend:'infobox("Выход 3")', begin:'door3.click', fill:'freeze' }), 'mpath', {}).setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#path3');
   //
  DC.extend(DC.root.getElementById('door1'), { onmousemove: function(e){ DC.doMap(e, { 'stroke-width': mds(10) }); }});
  DC.extend(DC.root.getElementById('door2'), { onmousemove: function(e){ DC.doMap(e, { 'stroke-width': mds(10) }); }});
  DC.extend(DC.root.getElementById('door3'), { onmousemove: function(e){ DC.doMap(e, { 'stroke-width': mds(10) }); }});
}
 //
function doorClick(){ DC.attr(DC.root.getElementById('ball'), {transform: 'translate('+DC.toPoints([-180,-8])[0]+',-'+DC.toPoints([-180,-8])[1]+')'}); }
 //
var DC = new dbCartaSvg({id:'mcont', bg:'none', sbar:0, height: document.getElementById('mcont').offsetHeight});
DC.scaleCarta( Number(DC.sizeOf()[2])>Number(DC.sizeOf()[3]) ? 0.4 : 0.8 );
draw();
infobox('Выберите дверь');
</script>
</body>
</html>
